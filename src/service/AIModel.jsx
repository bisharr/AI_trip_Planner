// const {
//   GoogleGenerativeAI,
//   HarmCategory,
//   HarmBlockThreshold,
// } = require("@google/generative-ai");
// const fs = require("node:fs");
// const mime = require("mime-types");

import { GoogleGenAI } from "@google/genai";

// const apiKey = "AIzaSyCKPaMOFURKXnokmRNEKUTTrjiyPUNN3u4";
const genAI = new GoogleGenAI({
  apiKey: "AIzaSyCKPaMOFURKXnokmRNEKUTTrjiyPUNN3u4",
});

const model = genAI.generateContent({
  model: "gemini-2.5-pro-preview-03-25",
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 64,
  maxOutputTokens: 65536,
  responseModalities: [],
  responseMimeType: "application/json",
};

export const chatSession = model.startChat({
  generationConfig,
  history: [
    {
      role: "user",
      parts: [
        {
          text: "Generate travel Plan for loaction: Las vegas for 3 days for couple with cheap budget give me hotels options list with  HotelName,Hotel address, Price, Hotel Image url, geo coordinates, rating,description and suggest itinery with placeName, place details, Place image url geoCoordinates, ticket price, Time travel,each of the location 3 days with  each day plan with the best time to visit in JSON FORMAT",
        },
      ],
    },
    {
      role: "model",
      parts: [
        {
          text: 'Here\'s a breakdown of the thought process to generate the Las Vegas itinerary:\n\n1.  **Understand the Core Request:** The user wants a 3-day Las Vegas travel plan for a couple on a *cheap budget*. Key elements required are:\n    *   Hotel options (Name, Address, Price, Image URL, Geo Coords, Rating, Description).\n    *   Daily itinerary (Place Name, Details, Image URL, Geo Coords, Ticket Price, Travel Time, Best Time to Visit).\n    *   Format: JSON.\n    *   Focus: Budget-friendly activities.\n\n2.  **Initial Brainstorming - Budget Vegas:**\n    *   What makes Vegas expensive? Gambling (avoid large sums), high-end shows, fancy restaurants, luxury hotels, expensive clubs.\n    *   What makes Vegas cheap/free? Walking the Strip, window shopping, people-watching, free attractions (Bellagio Fountains, Volcano, Fremont Street Experience), cheaper food options (food courts, off-Strip), happy hours, budget hotels (off-Strip or older Strip properties).\n    *   Couple focus: Add some romantic but cheap elements (viewpoints, shared experiences).\n\n3.  **Hotel Strategy (Budget):**\n    *   **Location:** Off-Strip or Downtown (Fremont Street) hotels are generally cheaper than mid-Strip hotels. Older Strip hotels can also be budget-friendly.\n    *   **Amenities:** Focus on clean and safe, not necessarily luxurious. Pools are nice but not essential for a short, budget trip. Avoid high resort fees if possible (though hard in Vegas).\n    *   **Selection Criteria:** Need name, address, *estimated* price range (actual prices fluctuate wildly), placeholder image URL, placeholder geo-coords, *estimated* rating, and a brief description highlighting budget-friendliness.\n    *   **Candidate Hotels (Mental List):** Excalibur, Luxor (South Strip, older but iconic), Flamingo (Mid-Strip, older but central), LINQ (Mid-Strip, modern but can have deals), Harrah\'s (Mid-Strip), Treasure Island (TI - North Strip), Circus Circus (Very budget, family-oriented, North Strip), Stratosphere (North Strip/Off-Strip, known for tower), Golden Nugget (Downtown), Four Queens (Downtown), El Cortez (Downtown, historic).\n    *   **Filtering for the JSON:** Pick 3-4 diverse options covering different areas (South Strip, Mid-Strip, Downtown) to give the user choice. *Self-correction:* Need to explicitly state prices are *estimates* and vary greatly. Use placeholders for image URLs and precise geo-coords, as finding real-time, accurate ones for a generic plan is impractical and might require API calls. Add a note about resort fees.\n\n4.  **Itinerary Strategy (Budget & Couple):**\n    *   **Structure:** 3 distinct days. Morning, Afternoon, Evening slots.\n    *   **Pacing:** Don\'t overschedule. Allow for walking/travel time. Mix free and low-cost activities.\n    *   **Flow:** Group activities geographically to minimize travel time (e.g., focus on South/Mid-Strip one day, Downtown another).\n    *   **Day 1: Arrival & Strip Exploration (South/Mid):**\n        *   Arrive, check-in.\n        *   Walk the South/Mid Strip: See iconic casinos from the outside (MGM, NYNY, Excalibur, Luxor).\n        *   Free Attraction: Bellagio Fountains (Evening).\n        *   Free Attraction: Bellagio Conservatory.\n        *   Budget Dinner: Food court or casual eatery.\n        *   Optional Low Cost: High Roller Observation Wheel (can often find deals).\n    *   **Day 2: Downtown & Different Vibe:**\n        *   Travel to Downtown (Deuce bus is cheap).\n        *   Explore Fremont Street: Casinos, quirky shops.\n        *   Free Attraction: Fremont Street Experience light show (Evening).\n        *   Low Cost Activity: Neon Museum (unique Vegas history, book in advance). Alternatively, Mob Museum (more expensive, maybe skip for *strict* budget).\n        *   Budget Lunch/Dinner: Downtown has many cheaper options.\n    *   **Day 3: More Strip & Departure Prep:**\n        *   Explore North/Mid Strip: Venetian/Palazzo (canals - free to see), Mirage Volcano (free - *check if still running* - Self-correction: *Mirage volcano is closing/closed, better swap it out*). Let\'s replace Volcano with something else free/cheap like the Flamingo Wildlife Habitat.\n        *   Window Shopping: Forum Shops at Caesars, Miracle Mile Shops at Planet Hollywood.\n        *   Free Activity: "Welcome to Fabulous Las Vegas" sign (requires bus/Uber/walk).\n        *   Budget Lunch.\n        *   Optional Low Cost: Maybe a cheaper matinee show or happy hour deal before heading to the airport.\n        *   Departure.\n\n5.  **Populating Itinerary Details:**\n    *   For each place:\n        *   `placeName`: Clear and concise.\n        *   `placeDetails`: Brief description of what it is and why it\'s relevant (especially for budget).\n        *   `placeImageUrl`: Placeholder URL (e.g., `https://example.com/image_placeholder.jpg`). *Self-correction:* Acknowledge these are placeholders.\n        *   `geoCoordinates`: Placeholder (e.g., `{"latitude": 36.xxxx, "longitude": -115.xxxx}`). Mention these are approximate.\n        *   `ticketPrice`: Specify "Free" or estimate a low range (e.g., "$10-$25"). Mention that prices can change.\n        *   `travelTime`: Estimate travel *between* locations (e.g., "15-20 min walk", "20 min bus ride").\n        *   `bestTimeToVisit`: Suggest optimal times (e.g., "Evening for lights", "Daytime for walking").\n\n6.  **JSON Formatting:**\n    *   Structure the entire output within a main JSON object `{}`.\n    *   Create top-level keys: `tripDetails`, `hotelOptions`, `dailyItinerary`.\n    *   `tripDetails`: Include location, duration, budgetFocus, travelerType.\n    *   `hotelOptions`: An array `[]` where each element is a hotel object `{}` containing the requested fields (HotelName, HotelAddress, Price, HotelImageUrl, geoCoordinates, Rating, Description). Ensure price notes the estimate/variability and resort fees.\n    *   `dailyItinerary`: An array `[]` where each element represents a day object `{}`.\n    *   Each day object should have a `day` key (e.g., "Day 1") and a `plan` key, which is an array `[]` of activity objects `{}`.\n    *   Each activity object should contain the requested fields (`placeName`, `placeDetails`, `placeImageUrl`, `geoCoordinates`, `ticketPrice`, `travelTime`, `bestTimeToVisit`).\n    *   Pay close attention to syntax: curly braces for objects `{}`, square brackets for arrays `[]`, key-value pairs with keys in double quotes `""`, string values in double quotes `""`, numbers without quotes, commas `,` between elements/pairs (but not after the last one in a block).\n\n7.  **Review and Refine:**\n    *   Read through the generated JSON. Does it match the request?\n    *   Are the budget suggestions realistic? (Avoided expensive shows, clubs, fine dining).\n    *   Is the itinerary logically sequenced?\n    *   Are placeholders clearly marked or explained? (Especially for prices, URLs, coords).\n    *   Is the JSON syntax valid? (Use a validator if unsure).\n    *   Add introductory and concluding remarks explaining the placeholders and variability. Emphasize checking current prices and availability. Mention transportation options (walking, Deuce bus, RTC). Add a note about hydration and comfortable shoes.\n\nThis structured approach ensures all requirements are met, the budget focus is maintained, and the output is well-organized and formatted correctly in JSON. The self-correction steps help refine the plan (e.g., replacing the Mirage Volcano).',
        },
        {
          text: '```json\n{\n  "tripDetails": {\n    "location": "Las Vegas, Nevada, USA",\n    "duration": "3 Days",\n    "travelerType": "Couple",\n    "budgetFocus": "Cheap / Budget-Friendly",\n    "notes": "This plan focuses on free or low-cost activities. Prices for hotels and tickets are estimates and can vary significantly based on booking time, day of the week, and events. Always check current prices and availability. Remember to factor in resort fees for hotels, which are often mandatory and not included in the base price. Comfortable walking shoes are essential!"\n  },\n  "hotelOptions": [\n    {\n      "HotelName": "Excalibur Hotel & Casino",\n      "HotelAddress": "3850 S Las Vegas Blvd, Las Vegas, NV 89109",\n      "Price": "$30 - $150+ per night (highly variable, plus resort fee)",\n      "HotelImageUrl": "https://example.com/excalibur_image.jpg",\n      "geoCoordinates": {\n        "latitude": 36.1046,\n        "longitude": -115.1745\n      },\n      "Rating": "3.5 stars (approx)",\n      "Description": "Iconic castle-themed hotel on the South Strip. Offers basic, budget-friendly rooms, a large casino, food court, and seasonal pool. Good value for its location, connected by tram to Luxor and Mandalay Bay."\n    },\n    {\n      "HotelName": "Flamingo Las Vegas Hotel & Casino",\n      "HotelAddress": "3555 S Las Vegas Blvd, Las Vegas, NV 89109",\n      "Price": "$40 - $180+ per night (highly variable, plus resort fee)",\n      "HotelImageUrl": "https://example.com/flamingo_image.jpg",\n      "geoCoordinates": {\n        "latitude": 36.1162,\n        "longitude": -115.1706\n      },\n      "Rating": "3.5 stars (approx)",\n      "Description": "Classic Vegas hotel with a prime Center Strip location. Known for its vibrant atmosphere, GO Pool (dayclub), and the free Wildlife Habitat. Rooms can be dated but often offer good value."\n    },\n    {\n      "HotelName": "The LINQ Hotel + Experience",\n      "HotelAddress": "3535 S Las Vegas Blvd, Las Vegas, NV 89109",\n      "Price": "$45 - $200+ per night (highly variable, plus resort fee)",\n      "HotelImageUrl": "https://example.com/linq_image.jpg",\n      "geoCoordinates": {\n        "latitude": 36.1177,\n        "longitude": -115.1710\n      },\n      "Rating": "4 stars (approx)",\n      "Description": "Modern hotel in a central location with smaller, efficient rooms. Focuses on the LINQ Promenade entertainment district right outside, featuring shops, restaurants, and the High Roller observation wheel."\n    },\n    {\n      "HotelName": "Golden Nugget Las Vegas Hotel & Casino",\n      "HotelAddress": "129 E Fremont St, Las Vegas, NV 89101",\n      "Price": "$50 - $200+ per night (highly variable, plus resort fee)",\n      "HotelImageUrl": "https://example.com/golden_nugget_image.jpg",\n      "geoCoordinates": {\n        "latitude": 36.1709,\n        "longitude": -115.1412\n      },\n      "Rating": "4 stars (approx)",\n      "Description": "Located in Downtown Las Vegas on the Fremont Street Experience. Offers more upscale rooms for Downtown, a famous pool with a shark tank slide (\'The Tank\'), and classic Vegas charm. Often cheaper than comparable Strip hotels."\n    }\n  ],\n  "dailyItinerary": [\n    {\n      "day": "Day 1: Arrival & South/Mid-Strip Exploration",\n      "plan": [\n        {\n          "placeName": "Arrival & Hotel Check-in",\n          "placeDetails": "Arrive at Harry Reid International Airport (LAS), take a shuttle or rideshare (~$15-30) to your hotel. Check in and leave luggage.",\n          "placeImageUrl": "https://example.com/las_airport.jpg",\n          "geoCoordinates": {\n            "latitude": 36.0840,\n            "longitude": -115.1537\n          },\n          "ticketPrice": "Transportation cost varies",\n          "travelTime": "20-40 minutes from airport to Strip/Downtown",\n          "bestTimeToVisit": "Afternoon"\n        },\n        {\n          "placeName": "Walk the South Strip",\n          "placeDetails": "Start exploring! Walk north from your hotel (or starting near Excalibur/NYNY). See the exteriors of iconic hotels like Luxor (Pyramid), Excalibur (Castle), New York-New York (NYC skyline/roller coaster). Pop into casinos to see the themes, but avoid extensive gambling on a budget.",\n          "placeImageUrl": "https://example.com/south_strip_walk.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1025,\n            "longitude": -115.1745\n          },\n          "ticketPrice": "Free",\n          "travelTime": "Ongoing walk",\n          "bestTimeToVisit": "Late Afternoon / Early Evening"\n        },\n        {\n          "placeName": "Bellagio Conservatory & Botanical Gardens",\n          "placeDetails": "Inside the Bellagio Hotel, this stunning indoor garden features elaborate floral displays that change seasonally. A beautiful and free attraction.",\n          "placeImageUrl": "https://example.com/bellagio_conservatory.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1126,\n            "longitude": -115.1744\n          },\n          "ticketPrice": "Free",\n          "travelTime": "Walk (part of Strip exploration)",\n          "bestTimeToVisit": "Late Afternoon / Evening"\n        },\n        {\n          "placeName": "Bellagio Fountains Show",\n          "placeDetails": "Iconic water show synchronized to music and lights in the lake in front of the Bellagio. A must-see Vegas experience.",\n          "placeImageUrl": "https://example.com/bellagio_fountains.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1124,\n            "longitude": -115.1738\n          },\n          "ticketPrice": "Free",\n          "travelTime": "Located outside Bellagio",\n          "bestTimeToVisit": "Evening (shows run every 30 mins, then every 15 mins after 7 or 8 PM - check schedule)"\n        },\n        {\n          "placeName": "Budget Dinner",\n          "placeDetails": "Grab dinner at a budget-friendly spot. Options include hotel food courts (e.g., Excalibur, Luxor, Flamingo), Ocean One Bar & Grille (Miracle Mile Shops - known for lunch specials), or chain restaurants.",\n          "placeImageUrl": "https://example.com/budget_dinner_vegas.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1105,\n            "longitude": -115.1721 /* Example: Miracle Mile Shops */\n          },\n          "ticketPrice": "$10-$25 per person",\n          "travelTime": "Walk/Short Bus",\n          "bestTimeToVisit": "Evening"\n        }\n      ]\n    },\n    {\n      "day": "Day 2: Downtown Vegas & Fremont Street",\n      "plan": [\n        {\n          "placeName": "Travel to Downtown",\n          "placeDetails": "Take the Deuce bus (RTC Transit) northbound from the Strip to Downtown Las Vegas / Fremont Street Experience. A 24-hour pass is cost-effective for multiple trips.",\n          "placeImageUrl": "https://example.com/deuce_bus.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1699,\n            "longitude": -115.1400 /* Approx Center of Fremont St */\n          },\n          "ticketPrice": "~$6 for 2-hour pass, ~$8 for 24-hour pass",\n          "travelTime": "30-50 minutes depending on traffic & starting point",\n          "bestTimeToVisit": "Late Morning / Early Afternoon"\n        },\n        {\n          "placeName": "Explore Fremont Street (Daytime)",\n          "placeDetails": "Walk under the Viva Vision canopy, see the classic casinos (Golden Nugget, Binion\'s, Four Queens), Container Park (quirky shopping area made of shipping containers with a playground and stage), and soak in the different vibe compared to the Strip.",\n          "placeImageUrl": "https://example.com/fremont_daytime.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1703,\n            "longitude": -115.1408\n          },\n          "ticketPrice": "Free (unless shopping/eating)",\n          "travelTime": "Walk around Downtown",\n          "bestTimeToVisit": "Afternoon"\n        },\n        {\n          "placeName": "Neon Museum (Optional, Budget Choice)",\n          "placeDetails": "An outdoor \'boneyard\' displaying iconic old Las Vegas signs. It\'s a unique piece of Vegas history. Booking tickets in advance is highly recommended, especially for evening visits.",\n          "placeImageUrl": "https://example.com/neon_museum.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1798,\n            "longitude": -115.1359\n          },\n          "ticketPrice": "~$20-$28 per person (daytime is cheaper)",\n          "travelTime": "Short walk or bus ride from Fremont Street Experience",\n          "bestTimeToVisit": "Late Afternoon or Evening (check ticket prices/availability)"\n        },\n        {\n          "placeName": "Budget Dinner Downtown",\n          "placeDetails": "Downtown offers many cheaper food options compared to the Strip. Look for casino cafes, local eateries off Fremont, or places like Evel Pie (pizza) or Heart Attack Grill (gimmicky but potentially cheap if you finish).",\n          "placeImageUrl": "https://example.com/downtown_dinner.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1695,\n            "longitude": -115.1410\n          },\n          "ticketPrice": "$10-$20 per person",\n          "travelTime": "Walk",\n          "bestTimeToVisit": "Early Evening"\n        },\n        {\n          "placeName": "Fremont Street Experience Light Show",\n          "placeDetails": "Witness the spectacular Viva Vision light and sound show on the massive overhead canopy covering Fremont Street. Shows typically run hourly in the evening.",\n          "placeImageUrl": "https://example.com/fremont_light_show.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1700,\n            "longitude": -115.1405\n          },\n          "ticketPrice": "Free",\n          "travelTime": "Located on Fremont Street",\n          "bestTimeToVisit": "Evening (hourly shows, check schedule)"\n        }\n      ]\n    },\n    {\n      "day": "Day 3: Mid-Strip Wonders & Departure Prep",\n      "plan": [\n        {\n          "placeName": "Flamingo Wildlife Habitat",\n          "placeDetails": "A serene, free attraction located at the Flamingo Hotel. See Chilean flamingos, other exotic birds, fish, and turtles in a lush garden setting.",\n          "placeImageUrl": "https://example.com/flamingo_habitat.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1169,\n            "longitude": -115.1709\n          },\n          "ticketPrice": "Free",\n          "travelTime": "Walk or short bus ride (if not staying nearby)",\n          "bestTimeToVisit": "Morning / Daytime"\n        },\n        {\n          "placeName": "Explore Venetian & Palazzo",\n          "placeDetails": "Walk through the Venetian and Palazzo resorts. Admire the Italian-themed architecture, see the indoor canals (gondola rides cost money, but viewing is free), St. Mark\'s Square, and do some window shopping at the Grand Canal Shoppes.",\n          "placeImageUrl": "https://example.com/venetian_canals.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1244,\n            "longitude": -115.1716\n          },\n          "ticketPrice": "Free (unless taking gondola ride or shopping)",\n          "travelTime": "Walk from Flamingo/LINQ area",\n          "bestTimeToVisit": "Daytime"\n        },\n        {\n          "placeName": "\'Welcome to Fabulous Las Vegas\' Sign",\n          "placeDetails": "Take a classic photo at the iconic Las Vegas sign. It\'s located south of Mandalay Bay. You can walk (it\'s a bit far), take the Deuce bus, or a short rideshare.",\n          "placeImageUrl": "https://example.com/vegas_sign.jpg",\n          "geoCoordinates": {\n            "latitude": 36.0820,\n            "longitude": -115.1728\n          },\n          "ticketPrice": "Free",\n          "travelTime": "15-30 min bus/rideshare from South Strip; longer walk",\n          "bestTimeToVisit": "Morning (less crowded, better light) or Daytime"\n        },\n        {\n          "placeName": "Window Shopping & People Watching",\n          "placeDetails": "Explore more of the Strip\'s unique shops and malls like the Forum Shops at Caesars (Roman theme) or the Miracle Mile Shops at Planet Hollywood (affordable options). Enjoy the free entertainment of people-watching.",\n          "placeImageUrl": "https://example.com/forum_shops.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1170,\n            "longitude": -115.1746 /* Example: Forum Shops */\n          },\n          "ticketPrice": "Free",\n          "travelTime": "Walk",\n          "bestTimeToVisit": "Afternoon"\n        },\n        {\n          "placeName": "Final Budget Meal & Departure",\n          "placeDetails": "Have a final cheap lunch or early dinner. Check out of your hotel (consider late checkout options if needed/available). Head back to the airport via shuttle or rideshare.",\n          "placeImageUrl": "https://example.com/final_meal_vegas.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1146,\n            "longitude": -115.1728 /* Example: Mid-Strip Area */\n          },\n          "ticketPrice": "$10-$25 per person",\n          "travelTime": "Allow ample time for travel to airport (at least 2-3 hours before flight)",\n          "bestTimeToVisit": "Afternoon / Early Evening"\n        }\n      ]\n    }\n  ]\n}\n```',
        },
      ],
    },
  ],
});
